{"version":3,"file":"index.js","sources":["../src/RichEditorTooltip.ts","../src/RichEditorTheme.ts","../src/createQuill.ts","../src/renderQuill.ts"],"sourcesContent":["import Quill from \"quill\";\nimport \"long-press-event\";\nimport type * as RegistryModule from \"parchment/src/registry\";\nimport type { BoundsStatic, Sources } from \"quill\";\nimport type { RangeStatic } from \"quill\";\nimport type TooltipClass from \"quill/ui/tooltip\";\n\nconst Parchment = Quill.import(\"parchment\");\nconst Registry: typeof RegistryModule = Parchment.Registry;\nconst LinkBlot = Quill.import(\"formats/link\");\nconst FormulaBlot = Quill.import(\"formats/formula\");\nconst Tooltip: typeof TooltipClass = Quill.import(\"ui/tooltip\");\n\nexport class RichEditorTooltip extends Tooltip {\n  static TEMPLATE = [\n    '<span class=\"ql-tooltip-arrow\"></span>',\n    '<div class=\"ql-tooltip-editor\">',\n    '<input type=\"text\" data-link=\"https://quilljs.com\" data-video=\"Embed URL\"/>',\n    '<textarea placeholder=\"e=mc^2\"></textarea>',\n    '<div class=\"ql-katex\"></div>',\n    '<a class=\"ql-close\"></a>',\n    '<a class=\"ql-save\"></a>',\n    \"</div>\",\n  ].join(\"\");\n\n  protected textbox: HTMLInputElement;\n  protected textarea: HTMLTextAreaElement;\n  protected katex: HTMLDivElement;\n  protected range: RangeStatic | undefined;\n\n  constructor(quill: Quill, bounds?: HTMLElement) {\n    super(quill, bounds);\n    this.textbox = this.root.querySelector(\n      'input[type=\"text\"]'\n    ) as HTMLInputElement;\n    this.textarea = this.root.querySelector(\"textarea\") as HTMLTextAreaElement;\n    this.katex = this.root.querySelector(\"div.ql-katex\") as HTMLDivElement;\n    this.listen();\n  }\n\n  listen() {\n    const container = (this.quill as any).container as HTMLElement,\n      document = container.ownerDocument;\n\n    const onClick = (event: Event) => {\n      if (!container.contains(event.target as Node)) {\n        this.hide();\n      }\n    };\n    document.addEventListener(\"click\", onClick);\n\n    const observer = new MutationObserver((mutations) => {\n      for (const mutation of mutations) {\n        for (const removedNode of Array.from(mutation.removedNodes)) {\n          if (removedNode === container) {\n            document.removeEventListener(\"click\", onClick);\n            observer.disconnect();\n          }\n        }\n      }\n    });\n    observer.observe(container.parentElement, { childList: true });\n\n    container.setAttribute(\"data-long-press-delay\", \"500\");\n    container.addEventListener(\"long-press\", () => {\n      if (this.root.classList.contains(\"ql-editing\")) return;\n      const range = this.quill.getSelection(true);\n      if (range) {\n        this.openAt(range);\n      }\n    });\n    container.addEventListener(\n      \"click\",\n      (event) => {\n        const blot = Registry.find(event.target as HTMLElement, true);\n\n        if (blot) {\n          if (blot instanceof FormulaBlot) {\n            this.range = {\n              index: blot.offset(this.quill.scroll),\n              length: blot.length(),\n            };\n            this.edit(\"formula\", FormulaBlot.value(blot.domNode));\n            event.preventDefault();\n            event.stopPropagation();\n          }\n        }\n      },\n      { capture: true }\n    );\n    this.textarea.addEventListener(\"input\", () => {\n      (window as any).katex.render(this.textarea.value, this.katex, {\n        throwOnError: false,\n        errorColor: \"#f00\",\n      });\n    });\n    this.textbox.addEventListener(\"keydown\", (event) => {\n      if (event.key === \"Enter\") {\n        this.save();\n        event.preventDefault();\n      } else if (event.key === \"Escape\") {\n        this.cancel();\n        event.preventDefault();\n      }\n    });\n    this.quill.on(\n      \"selection-change\",\n      (range: RangeStatic, _oldRange: RangeStatic, source: Sources) => {\n        if (range != null && source === \"user\") {\n          if (\n            range.length === 0 &&\n            !this.root.classList.contains(\"ql-hidden\")\n          ) {\n            this.hide();\n          } else if (range.length > 0) {\n            this.openAt(range);\n          } else {\n            const [link, linkOffset] = (this.quill.scroll as any).descendant(\n              LinkBlot,\n              range.index\n            );\n            if (link != null) {\n              this.range = {\n                index: range.index - linkOffset,\n                length: link.length(),\n              };\n              this.edit(\"link\", LinkBlot.formats(link.domNode));\n            }\n          }\n        }\n      }\n    );\n    this.root.querySelector(\".ql-save\")?.addEventListener(\"click\", () => {\n      this.save();\n    });\n    this.root.querySelector(\".ql-close\")?.addEventListener(\"click\", () => {\n      this.cancel();\n    });\n    this.quill.on(\"scroll-optimize\" as any, () => {\n      setTimeout(() => {\n        if (this.root.classList.contains(\"ql-hidden\")) return;\n        const range = this.quill.getSelection();\n        if (range != null) {\n          this.position(this.quill.getBounds(range.index, range.length));\n        }\n      }, 1);\n    });\n  }\n\n  openAt(range: RangeStatic) {\n    this.show();\n    this.root.style.left = \"0px\";\n    this.root.style.width = \"\";\n    this.root.style.width = `${this.root.offsetWidth}px`;\n    const lines = this.quill.getLines(range.index, range.length);\n    if (lines.length <= 1) {\n      this.position(this.quill.getBounds(range.index, range.length));\n    } else {\n      const lastLine = lines[lines.length - 1];\n      const index = this.quill.getIndex(lastLine);\n      const length = Math.min(\n        lastLine.length() - 1,\n        range.index + range.length - index\n      );\n      const indexBounds = this.quill.getBounds(index, length);\n      this.position(indexBounds);\n    }\n  }\n\n  position(reference: BoundsStatic) {\n    const left =\n      reference.left + reference.width / 2 - this.root.offsetWidth / 2;\n    const top = reference.bottom + this.quill.root.scrollTop;\n    this.root.style.left = `${left}px`;\n    this.root.style.top = `${top}px`;\n    const containerBounds = this.boundsContainer.getBoundingClientRect();\n    const rootBounds = this.root.getBoundingClientRect();\n    let shift = 0;\n    if (rootBounds.right > containerBounds.right) {\n      shift = containerBounds.right - rootBounds.right;\n      this.root.style.left = `${left + shift}px`;\n    }\n    if (rootBounds.left < containerBounds.left) {\n      shift = containerBounds.left - rootBounds.left;\n      this.root.style.left = `${left + shift}px`;\n    }\n    const arrow = this.root.querySelector(\".ql-tooltip-arrow\") as HTMLElement;\n    arrow.style.marginLeft = \"\";\n    if (shift !== 0) {\n      arrow.style.marginLeft = `${-1 * shift - arrow.offsetWidth / 2}px`;\n    }\n    return shift;\n  }\n\n  show() {\n    this.root.classList.remove(\"ql-editing\");\n    this.root.classList.remove(\"ql-hidden\");\n    if (this.textbox) this.textbox.value = \"\";\n    if (this.textarea) this.textarea.value = \"\";\n    if (this.katex) this.katex.innerHTML = \"\";\n    this.root.removeAttribute(\"data-mode\");\n  }\n\n  hide() {\n    this.root.classList.remove(\"ql-editing\");\n    this.root.classList.add(\"ql-hidden\");\n    this.root.removeAttribute(\"data-mode\");\n  }\n\n  cancel() {\n    this.show();\n  }\n\n  edit(mode: string, preview?: string) {\n    this.root.classList.remove(\"ql-hidden\");\n    this.root.classList.add(\"ql-editing\");\n    if (preview != null) {\n      if (mode === \"formula\") {\n        this.textarea.value = preview;\n        this.textbox.value = \"\";\n      } else {\n        this.textbox.value = preview;\n        this.textarea.value = \"\";\n      }\n    }\n    this.position(\n      this.quill.getBounds((this.quill as any).selection.savedRange)\n    );\n    if (mode === \"formula\") {\n      this.textarea.select();\n    } else {\n      this.textbox.select();\n      this.textbox.setAttribute(\n        \"placeholder\",\n        this.textbox.getAttribute(`data-${mode}`) || \"\"\n      );\n    }\n    this.root.setAttribute(\"data-mode\", mode);\n  }\n\n  restoreFocus() {\n    const scrollingContainer: HTMLElement = (this.quill as any)\n        .scrollingContainer,\n      scrollTop = scrollingContainer.scrollTop;\n    this.quill.focus();\n    scrollingContainer.scrollTop = scrollTop;\n  }\n\n  save() {\n    const mode = this.root.getAttribute(\"data-mode\");\n    let value = mode === \"formula\" ? this.textarea.value : this.textbox.value;\n    switch (mode) {\n      case \"link\": {\n        const scrollTop = this.quill.root.scrollTop;\n        if (this.range) {\n          this.quill.formatText(this.range, \"link\", value, \"user\");\n          this.range = undefined;\n        } else {\n          this.restoreFocus();\n          this.quill.format(\"link\", value, \"user\");\n        }\n        this.quill.root.scrollTop = scrollTop;\n        break;\n      }\n      case \"video\": {\n        value = extractVideoUrl(value);\n      }\n      case \"formula\": {\n        if (!value) break;\n        if (this.range) {\n          this.quill.deleteText(this.range.index, this.range.length, \"user\");\n          this.range = undefined;\n        }\n        const range = this.quill.getSelection(true);\n        if (range != null) {\n          const index = range.index + range.length;\n          this.quill.insertEmbed(index, mode, value, \"user\");\n          if (mode === \"formula\") {\n            this.quill.insertText(index + 1, \" \", \"user\");\n          }\n          this.quill.setSelection(index + 2, 0, \"user\");\n        }\n        break;\n      }\n      default:\n    }\n    this.hide();\n  }\n}\n\nfunction extractVideoUrl(url: string): string {\n  let match =\n    url.match(\n      /^(?:(https?):\\/\\/)?(?:(?:www|m)\\.)?youtube\\.com\\/watch.*v=([a-zA-Z0-9_-]+)/\n    ) ||\n    url.match(/^(?:(https?):\\/\\/)?(?:(?:www|m)\\.)?youtu\\.be\\/([a-zA-Z0-9_-]+)/);\n\n  if (match) {\n    return `${match[1] || \"https\"}://www.youtube.com/embed/${\n      match[2]\n    }?showinfo=0`;\n  } else if (\n    (match = url.match(/^(?:(https?):\\/\\/)?(?:www\\.)?vimeo\\.com\\/(\\d+)/))\n  ) {\n    return `${match[1] || \"https\"}://player.vimeo.com/video/${match[2]}/`;\n  } else {\n    return url;\n  }\n}\n","import Quill from \"quill\";\nimport type { QuillOptionsStatic } from \"quill\";\nimport type BubbleThemeClass from \"quill/themes/snow\";\nimport { RichEditorTooltip } from \"./RichEditorTooltip\";\n\nconst BubbleTheme: typeof BubbleThemeClass = Quill.import(\"themes/snow\");\nconst icons = Quill.import(\"ui/icons\");\n\nconst TOOLBAR_CONFIG = [\n  [{ header: [\"1\", \"2\", \"3\", false] }],\n  [\"bold\", \"italic\", \"underline\", \"strike\"],\n  [{ color: [] }, { background: [] }],\n  [\"code-block\", \"formula\"],\n  [\n    {\n      list: \"ordered\",\n    },\n    {\n      list: \"bullet\",\n    },\n  ],\n  [\n    {\n      align: [],\n    },\n  ],\n  [\"link\", \"image\"],\n  [\"clean\"],\n];\n\nconst BUBBLE_DEFAULTS = BubbleTheme.DEFAULTS as any;\nexport class RichEditorTheme extends BubbleTheme {\n  static DEFAULTS = {\n    ...BUBBLE_DEFAULTS,\n    modules: {\n      ...BUBBLE_DEFAULTS.modules,\n      toolbar: {\n        ...BUBBLE_DEFAULTS.toolbar,\n        handlers: {\n          link(value: string) {\n            if (value) {\n              const range = this.quill.getSelection();\n              if (range == null || range.length === 0) return;\n              let preview = this.quill.getText(range);\n              if (\n                /^\\S+@\\S+\\.\\S+$/.test(preview) &&\n                preview.indexOf(\"mailto:\") !== 0\n              ) {\n                preview = `mailto:${preview}`;\n              }\n              this.quill.theme.tooltip.edit(\"link\", preview);\n            } else {\n              this.quill.format(\"link\", false);\n            }\n          },\n        },\n      },\n    },\n  };\n\n  constructor(quill: Quill, options: QuillOptionsStatic) {\n    if (\n      options.modules &&\n      options.modules.toolbar != null &&\n      options.modules.toolbar.container == null\n    ) {\n      options.modules.toolbar.container = TOOLBAR_CONFIG;\n    }\n    super(quill, options);\n    (this.quill as any).container.classList.add(\"ql-rich-editor\");\n  }\n\n  extendToolbar(toolbar: any) {\n    toolbar.container.classList.add(\"ql-rich-editor\");\n\n    this.tooltip = new RichEditorTooltip(this.quill, this.options.bounds);\n    this.tooltip.root.appendChild(toolbar.container);\n\n    this.buildButtons(toolbar.container.querySelectorAll(\"button\"), icons);\n    this.buildPickers(toolbar.container.querySelectorAll(\"select\"), icons);\n  }\n}\n\nQuill.register(\"themes/rich-editor\", RichEditorTheme, true);\n","import Quill from \"quill\";\n\nexport function createQuill(\n  element: HTMLElement,\n  placeholder = \"Write... (Long Click/Press to Open Toolbar)\"\n) {\n  return new Quill(element, {\n    modules: {\n      syntax: true,\n    },\n    theme: \"rich-editor\",\n    placeholder,\n  });\n}\n","import type Quill from \"quill\";\nimport type Delta from \"quill-delta\";\nimport type Op from \"quill-delta/dist/Op\";\nimport { createQuill } from \"./createQuill\";\n\nexport function renderQuill(node: HTMLElement, quill: Quill) {\n  node.innerHTML = `<div class=\"ql-container ql-snow ql-rich-editor ql-read-only\"><div class=\"ql-editor\">${\n    (quill as any).root.innerHTML\n  }</div></div>`;\n\n  Array.from(node.querySelectorAll<HTMLElement>(\".ql-code-block\")).forEach(\n    (codeBlock) => {\n      codeBlock.innerHTML = (window as any).hljs.highlight(\n        codeBlock.getAttribute(\"data-language\"),\n        codeBlock.innerText\n      ).value;\n    }\n  );\n}\n\nexport function renderOps(node: HTMLElement, ops: Op[]) {\n  const document = node.ownerDocument,\n    tmp = document.createElement(\"div\");\n\n  tmp.style.display = \"none\";\n  document.body.appendChild(tmp);\n\n  const quill = createQuill(tmp);\n  quill.setContents({ ops } as Delta);\n\n  renderQuill(node, quill);\n  document.body.removeChild(tmp);\n}\n"],"names":["Registry","Quill","import","LinkBlot","FormulaBlot","Tooltip","RichEditorTooltip","constructor","quill","bounds","super","this","textbox","root","querySelector","textarea","katex","listen","container","document","ownerDocument","onClick","event","contains","target","hide","addEventListener","observer","MutationObserver","mutations","mutation","removedNode","Array","from","removedNodes","removeEventListener","disconnect","observe","parentElement","childList","setAttribute","classList","range","getSelection","openAt","blot","find","index","offset","scroll","length","edit","value","domNode","preventDefault","stopPropagation","capture","window","render","throwOnError","errorColor","key","save","cancel","on","_oldRange","source","link","linkOffset","descendant","formats","setTimeout","position","getBounds","show","style","left","width","offsetWidth","lines","getLines","lastLine","getIndex","Math","min","indexBounds","reference","top","bottom","scrollTop","containerBounds","boundsContainer","getBoundingClientRect","rootBounds","shift","right","arrow","marginLeft","remove","innerHTML","removeAttribute","add","mode","preview","selection","savedRange","select","getAttribute","restoreFocus","scrollingContainer","focus","formatText","undefined","format","url","match","extractVideoUrl","deleteText","insertEmbed","insertText","setSelection","join","BubbleTheme","icons","TOOLBAR_CONFIG","header","color","background","list","align","BUBBLE_DEFAULTS","DEFAULTS","RichEditorTheme","options","modules","toolbar","extendToolbar","tooltip","appendChild","buildButtons","querySelectorAll","buildPickers","createQuill","element","placeholder","syntax","theme","renderQuill","node","forEach","codeBlock","hljs","highlight","innerText","renderOps","ops","tmp","createElement","display","body","setContents","removeChild","handlers","getText","test","indexOf","register"],"mappings":"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"}